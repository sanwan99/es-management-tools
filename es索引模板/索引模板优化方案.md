# ESç´¢å¼•æ¨¡æ¿ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“Š ç°çŠ¶åˆ†æ

### å½“å‰æ¨¡æ¿åˆ†ç‰‡é…ç½®
- `logstash-loghub-month-tpl` (order: 0): **3åˆ†ç‰‡** âŒ
- `logstash-dev-test` (order: 1): 1åˆ†ç‰‡ âœ“
- `logstash-low-volume-prd` (order: 3): 1åˆ†ç‰‡ âœ“
- `logstash-medium-volume-logs-prd` (order: 4): **2åˆ†ç‰‡** âŒ
- `logstash-high-volume-logs-prd` (order: 5): **3åˆ†ç‰‡** âŒ

### èµ„æºæµªè´¹æƒ…å†µ
**å°ç´¢å¼•å ç”¨3åˆ†ç‰‡**ï¼š
- `travel-ship-prd` (3.4GB) â†’ 1.13GB/åˆ†ç‰‡
- `platform-int-taobao` (6.3GB) â†’ 2.1GB/åˆ†ç‰‡  
- `message-center-prd` (9.7GB) â†’ 3.23GB/åˆ†ç‰‡
- `platform-coupon-api-prd` (9.4GB) â†’ 3.13GB/åˆ†ç‰‡

**é¢„è®¡èŠ‚çº¦**ï¼šä»66ä¸ªåˆ†ç‰‡å‡å°‘åˆ°çº¦30ä¸ªåˆ†ç‰‡ï¼ŒèŠ‚çº¦50%+èµ„æº

## ğŸ¯ ä¼˜åŒ–ç­–ç•¥

### åˆ†ç‰‡åˆ†é…åŸåˆ™
```bash
# è¶…å¤§ç´¢å¼• (>50GB) â†’ 3åˆ†ç‰‡
iroom-prd (108.5GB), platform-int-int (58.9GB), guardian-prd (57.6GB)

# å¤§ç´¢å¼• (30-50GB) â†’ 2åˆ†ç‰‡
website-platform-api-common (39.8GB), product-room-api-prd (38.8GB)

# å…¶ä»–æ‰€æœ‰ç´¢å¼• â†’ 1åˆ†ç‰‡
æ‰€æœ‰å°äº30GBçš„ç´¢å¼•
```

## ğŸ”§ æ‰§è¡Œæ–¹æ¡ˆ

### 1. æ–°å¢è¶…å¤§ç´¢å¼•æ¨¡æ¿ï¼ˆåŒ…å«å®Œæ•´mappingï¼‰
```bash
curl -X PUT "http://192.168.0.93:9201/_template/logstash-super-volume-prd" -H 'Content-Type: application/json' -d'
{
  "order": 10,
  "index_patterns": [
    "logstash-loghub-logs-iroom-prd-*",
    "logstash-loghub-logs-platform-int-int-*", 
    "logstash-loghub-logs-guardian-prd-*"
  ],
  "settings": {
    "index": {
      "highlight": {
        "max_analyzed_offset": "1000000"
      },
      "routing": {
        "allocation": {
          "require": {
            "node-type": "hot"
          }
        }
      },
      "refresh_interval": "30s",
      "number_of_shards": "3",
      "translog": {
        "flush_threshold_size": "512mb",
        "sync_interval": "30s",
        "durability": "async"
      },
      "merge": {
        "scheduler": {
          "max_thread_count": "1",
          "max_merge_count": "100"
        }
      },
      "number_of_replicas": "0"
    }
  },
  "mappings": {
    "properties": {
      "logStore": {
        "type": "keyword"
      },
      "traceId": {
        "type": "keyword"
      },
      "internetIp": {
        "type": "keyword"
      },
      "os": {
        "type": "keyword"
      },
      "level": {
        "type": "keyword"
      },
      "tomcat": {
        "type": "keyword"
      },
      "project": {
        "type": "keyword"
      },
      "thread": {
        "type": "keyword"
      },
      "message": {
        "type": "text"
      },
      "logsClientVersion": {
        "type": "keyword"
      },
      "uuid": {
        "type": "keyword"
      },
      "spanId": {
        "type": "keyword"
      },
      "hostname": {
        "type": "keyword"
      },
      "msgObj": {
        "type": "object"
      },
      "sourceIp": {
        "type": "keyword"
      },
      "topic": {
        "type": "keyword"
      },
      "location": {
        "type": "keyword"
      },
      "time": {
        "type": "date"
      }
    }
  },
  "aliases": {}
}'
```

### 2. æ–°å¢å¤§ç´¢å¼•æ¨¡æ¿ï¼ˆåŒ…å«å®Œæ•´mappingï¼‰
```bash
curl -X PUT "http://192.168.0.93:9201/_template/logstash-large-volume-prd" -H 'Content-Type: application/json' -d'
{
  "order": 8,
  "index_patterns": [
    "logstash-loghub-logs-website-platform-api-common-*",
    "logstash-loghub-logs-product-room-api-prd-*"
  ],
  "settings": {
    "index": {
      "highlight": {
        "max_analyzed_offset": "1000000"
      },
      "routing": {
        "allocation": {
          "require": {
            "node-type": "hot"
          }
        }
      },
      "refresh_interval": "30s",
      "number_of_shards": "2",
      "translog": {
        "flush_threshold_size": "512mb",
        "sync_interval": "30s",
        "durability": "async"
      },
      "merge": {
        "scheduler": {
          "max_thread_count": "1",
          "max_merge_count": "100"
        }
      },
      "number_of_replicas": "0"
    }
  },
  "mappings": {
    "properties": {
      "logStore": {
        "type": "keyword"
      },
      "traceId": {
        "type": "keyword"
      },
      "internetIp": {
        "type": "keyword"
      },
      "os": {
        "type": "keyword"
      },
      "level": {
        "type": "keyword"
      },
      "tomcat": {
        "type": "keyword"
      },
      "project": {
        "type": "keyword"
      },
      "thread": {
        "type": "keyword"
      },
      "message": {
        "type": "text"
      },
      "logsClientVersion": {
        "type": "keyword"
      },
      "uuid": {
        "type": "keyword"
      },
      "spanId": {
        "type": "keyword"
      },
      "hostname": {
        "type": "keyword"
      },
      "msgObj": {
        "type": "object"
      },
      "sourceIp": {
        "type": "keyword"
      },
      "topic": {
        "type": "keyword"
      },
      "location": {
        "type": "keyword"
      },
      "time": {
        "type": "date"
      }
    }
  },
  "aliases": {}
}'
```

### 3. ä¿®æ”¹ç°æœ‰æ¨¡æ¿åˆ†ç‰‡æ•°ï¼ˆä¿ç•™å®Œæ•´mappingï¼‰

#### ä¿®æ”¹é»˜è®¤æ¨¡æ¿ä¸º1åˆ†ç‰‡
```bash
curl -X PUT "http://192.168.0.93:9201/_template/logstash-loghub-month-tpl" -H 'Content-Type: application/json' -d'
{
  "order": 0,
  "index_patterns": ["logstash-loghub-*"],
  "settings": {
    "index": {
      "highlight": {
        "max_analyzed_offset": "1000000"
      },
      "routing": {
        "allocation": {
          "require": {
            "node-type": "hot"
          }
        }
      },
      "refresh_interval": "30s",
      "number_of_shards": "1",
      "translog": {
        "flush_threshold_size": "512mb",
        "sync_interval": "30s",
        "durability": "async"
      },
      "merge": {
        "scheduler": {
          "max_thread_count": "1",
          "max_merge_count": "100"
        }
      },
      "number_of_replicas": "0"
    }
  },
  "mappings": {
    "properties": {
      "logStore": {
        "type": "keyword"
      },
      "traceId": {
        "type": "keyword"
      },
      "internetIp": {
        "type": "keyword"
      },
      "os": {
        "type": "keyword"
      },
      "level": {
        "type": "keyword"
      },
      "tomcat": {
        "type": "keyword"
      },
      "project": {
        "type": "keyword"
      },
      "thread": {
        "type": "keyword"
      },
      "message": {
        "type": "text"
      },
      "logsClientVersion": {
        "type": "keyword"
      },
      "uuid": {
        "type": "keyword"
      },
      "spanId": {
        "type": "keyword"
      },
      "hostname": {
        "type": "keyword"
      },
      "msgObj": {
        "type": "object"
      },
      "sourceIp": {
        "type": "keyword"
      },
      "topic": {
        "type": "keyword"
      },
      "location": {
        "type": "keyword"
      },
      "time": {
        "type": "date"
      }
    }
  },
  "aliases": {}
}'
```

#### ä¿®æ”¹ä¸­ç­‰æµé‡æ¨¡æ¿ä¸º1åˆ†ç‰‡
```bash
curl -X PUT "http://192.168.0.93:9201/_template/logstash-medium-volume-logs-prd" -H 'Content-Type: application/json' -d'
{
  "order": 4,
  "index_patterns": [
    "logstash-loghub-logs-*-prd-*",
    "logstash-loghub-logs-*-api-prd-*",
    "logstash-loghub-error-message-center-prd-*",
    "logstash-loghub-error-adapter-pms-exception-prd-*",
    "logstash-loghub-error-platform-debug-int-*",
    "logstash-loghub-error-iroom-prd-*",
    "logstash-loghub-error-platform-coupon-exception-prd-*"
  ],
  "settings": {
    "index": {
      "highlight": {
        "max_analyzed_offset": "1000000"
      },
      "routing": {
        "allocation": {
          "require": {
            "node-type": "hot"
          }
        }
      },
      "refresh_interval": "30s",
      "number_of_shards": "1",
      "translog": {
        "flush_threshold_size": "512mb",
        "sync_interval": "30s",
        "durability": "async"
      },
      "merge": {
        "scheduler": {
          "max_thread_count": "1",
          "max_merge_count": "100"
        }
      },
      "number_of_replicas": "0"
    }
  },
  "mappings": {
    "properties": {
      "logStore": {
        "type": "keyword"
      },
      "traceId": {
        "type": "keyword"
      },
      "internetIp": {
        "type": "keyword"
      },
      "os": {
        "type": "keyword"
      },
      "level": {
        "type": "keyword"
      },
      "tomcat": {
        "type": "keyword"
      },
      "project": {
        "type": "keyword"
      },
      "thread": {
        "type": "keyword"
      },
      "message": {
        "type": "text"
      },
      "logsClientVersion": {
        "type": "keyword"
      },
      "uuid": {
        "type": "keyword"
      },
      "spanId": {
        "type": "keyword"
      },
      "hostname": {
        "type": "keyword"
      },
      "msgObj": {
        "type": "object"
      },
      "sourceIp": {
        "type": "keyword"
      },
      "topic": {
        "type": "keyword"
      },
      "location": {
        "type": "keyword"
      },
      "time": {
        "type": "date"
      }
    }
  },
  "aliases": {}
}'
```

### 4. åˆ é™¤é«˜æµé‡æ¨¡æ¿
```bash
curl -X DELETE "http://192.168.0.93:9201/_template/logstash-high-volume-logs-prd"
```

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

### é¡ºåºæ‰§è¡Œ
1. **æ–°å¢è¶…å¤§ç´¢å¼•æ¨¡æ¿** (order: 10)
2. **æ–°å¢å¤§ç´¢å¼•æ¨¡æ¿** (order: 8)  
3. **ä¿®æ”¹ä¸­ç­‰æµé‡æ¨¡æ¿** (order: 4)
4. **ä¿®æ”¹é»˜è®¤æ¨¡æ¿** (order: 0)
5. **åˆ é™¤é«˜æµé‡æ¨¡æ¿** (order: 5)

### éªŒè¯å‘½ä»¤
```bash
# æ£€æŸ¥æ¨¡æ¿é…ç½®
curl -s "http://192.168.0.93:9201/_template/logstash*?pretty"

# æµ‹è¯•æ–°ç´¢å¼•åˆ›å»º
curl -X PUT "http://192.168.0.93:9201/logstash-loghub-logs-website-platform-api-common-2025-07-19"
curl -s "http://192.168.0.93:9201/logstash-loghub-logs-website-platform-api-common-2025-07-19/_settings?pretty" | grep number_of_shards
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åªå½±å“æ–°ç´¢å¼•**ï¼šç°æœ‰ç´¢å¼•åˆ†ç‰‡æ•°ä¸ä¼šæ”¹å˜
2. **æ¨¡æ¿ä¼˜å…ˆçº§**ï¼šorderå€¼è¶Šé«˜ä¼˜å…ˆçº§è¶Šé«˜
3. **æµ‹è¯•å»ºè®®**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
4. **å›æ»šæ–¹æ¡ˆ**ï¼šä¿ç•™åŸæ¨¡æ¿é…ç½®å¤‡ä»½

## ğŸ¯ é¢„æœŸæ•ˆæœ

### æ–°ç´¢å¼•åˆ†ç‰‡åˆ†é…
- `iroom-prd` â†’ 3åˆ†ç‰‡ (108.5GB)
- `platform-int-int` â†’ 3åˆ†ç‰‡ (58.9GB)  
- `guardian-prd` â†’ 3åˆ†ç‰‡ (57.6GB)
- `website-platform-api-common` â†’ 2åˆ†ç‰‡ (39.8GB)
- `product-room-api-prd` â†’ 2åˆ†ç‰‡ (38.8GB)
- **å…¶ä»–æ‰€æœ‰ç´¢å¼•** â†’ 1åˆ†ç‰‡

### èµ„æºèŠ‚çº¦
- **åˆ†ç‰‡æ•°é‡**ï¼šä»66ä¸ªå‡å°‘åˆ°30ä¸ª
- **èµ„æºèŠ‚çº¦**ï¼š50%+ å­˜å‚¨å’Œè®¡ç®—èµ„æº
- **æŸ¥è¯¢æ€§èƒ½**ï¼šå°ç´¢å¼•æŸ¥è¯¢æ›´å¿«
- **ç®¡ç†ç®€åŒ–**ï¼šç»Ÿä¸€çš„åˆ†ç‰‡ç­–ç•¥